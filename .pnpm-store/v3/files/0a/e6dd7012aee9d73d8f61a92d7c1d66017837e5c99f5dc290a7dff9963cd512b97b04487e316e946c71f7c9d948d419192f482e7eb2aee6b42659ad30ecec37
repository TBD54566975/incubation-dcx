(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ItMerge = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ItMerge=(()=>{var y=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var M=(r,e)=>{for(var t in e)y(r,t,{get:e[t],enumerable:!0})},_=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let u of P(e))!I.call(r,u)&&u!==t&&y(r,u,{get:()=>e[u],enumerable:!(i=N(e,u))||i.enumerable});return r};var A=r=>_(y({},"__esModule",{value:!0}),r);var B={};M(B,{default:()=>q});function c(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var p=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},a=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new p(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new p(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var w=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function g(r={}){return j(t=>{let i=t.shift();if(i==null)return{done:!0};if(i.error!=null)throw i.error;return{done:i.done===!0,value:i.value}},r)}function j(r,e){e=e??{};let t=e.onEnd,i=new a,u,o,f,b=c(),v=async()=>{try{return i.isEmpty()?f?{done:!0}:await new Promise((n,s)=>{o=d=>{o=null,i.push(d);try{n(r(i))}catch(h){s(h)}return u}}):r(i)}finally{i.isEmpty()&&queueMicrotask(()=>{b.resolve(),b=c()})}},x=n=>o!=null?o(n):(i.push(n),u),z=n=>(i=new a,o!=null?o({error:n}):(i.push({error:n}),u)),E=n=>{if(f)return u;if(e?.objectMode!==!0&&n?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return x({done:!1,value:n})},m=n=>f?u:(f=!0,n!=null?z(n):x({done:!0})),L=()=>(i=new a,m(),{done:!0}),S=n=>(m(n),{done:!0});if(u={[Symbol.asyncIterator](){return this},next:v,return:L,throw:S,push:E,end:m,get readableLength(){return i.size},onEmpty:async n=>{let s=n?.signal;if(s?.throwIfAborted(),i.isEmpty())return;let d,h;s!=null&&(d=new Promise((D,k)=>{h=()=>{k(new w)},s.addEventListener("abort",h)}));try{await Promise.race([b.promise,d])}finally{h!=null&&s!=null&&s?.removeEventListener("abort",h)}}},t==null)return u;let l=u;return u={[Symbol.asyncIterator](){return this},next(){return l.next()},throw(n){return l.throw(n),t!=null&&(t(n),t=void 0),{done:!0}},return(){return l.return(),t!=null&&(t(),t=void 0),{done:!0}},push:E,end(n){return l.end(n),t!=null&&(t(n),t=void 0),u},get readableLength(){return l.readableLength},onEmpty:n=>l.onEmpty(n)},u}function R(r){return r[Symbol.asyncIterator]!=null}function T(...r){let e=[];for(let t of r)R(t)||e.push(t);return e.length===r.length?function*(){for(let t of e)yield*t}():async function*(){let t=g({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async i=>{for await(let u of i)t.push(u)})),t.end()}catch(i){t.end(i)}}),yield*t}()}var q=T;return A(B);})();
return ItMerge}));
